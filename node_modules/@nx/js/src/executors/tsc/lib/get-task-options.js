"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.getTaskOptions = void 0;
const normalize_options_1 = require("./normalize-options");
const tasksOptionsCache = new Map();
function getTaskOptions(taskName, context) {
    if (tasksOptionsCache.has(taskName)) {
        return tasksOptionsCache.get(taskName);
    }
    try {
        const { taskOptions, sourceRoot, root } = parseTaskInfo(taskName, context);
        const normalizedTaskOptions = (0, normalize_options_1.normalizeOptions)(taskOptions, context.root, sourceRoot, root);
        tasksOptionsCache.set(taskName, normalizedTaskOptions);
        return normalizedTaskOptions;
    }
    catch (_a) {
        tasksOptionsCache.set(taskName, null);
        return null;
    }
}
exports.getTaskOptions = getTaskOptions;
function parseTaskInfo(taskName, context) {
    var _a, _b;
    const target = context.taskGraph.tasks[taskName].target;
    const projectNode = context.projectGraph.nodes[target.project];
    const targetConfig = (_a = projectNode.data.targets) === null || _a === void 0 ? void 0 : _a[target.target];
    const { sourceRoot, root } = projectNode.data;
    const taskOptions = Object.assign(Object.assign({}, targetConfig.options), (target.configuration
        ? (_b = targetConfig.configurations) === null || _b === void 0 ? void 0 : _b[target.configuration]
        : {}));
    return { taskOptions, root, sourceRoot, projectNode, target };
}
